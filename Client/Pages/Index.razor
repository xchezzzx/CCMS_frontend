@page "/"
@inject ICurrentUserService userService

<PageTitle>Index</PageTitle>

@if (!_dataFetched)
{
	<Loader />
}
else
{
	if (_errorFlag)
	{
		<Error Exception="@exception"/>
	}
	else
	{
		if (currentUser == null)
		{
			<EmptyList />
		}
		else
		{
			<Userpage User="@currentUser" />
		}
	}
}


@code {

	UserDT currentUser = new();
	bool _dataFetched;
	bool _errorFlag = false;
	Exception exception;

	protected override async Task OnInitializedAsync()
	{
		await FetchDataAsync();
	}

	private async Task FetchDataAsync()
	{
		try
		{
			_dataFetched = false;
			currentUser = await userService.GetCurrentUserAsync();
			_dataFetched = true;
			StateHasChanged();
		}
		catch(Exception ex)
		{
			_dataFetched = true;

			_errorFlag = true;
			exception = ex;
		}
	}
}
